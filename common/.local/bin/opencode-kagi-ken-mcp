#!/usr/bin/env bash
set -euo pipefail

install_dir="${HOME}/.local/share/opencode/mcp/kagi-ken-local"
bin_path="${install_dir}/node_modules/.bin/kagi-ken-mcp"
package_ref="@iflow-mcp/kagi-ken-mcp@1.1.0"

if [[ ! -x "${bin_path}" ]]; then
  if ! command -v npm >/dev/null 2>&1; then
    printf 'opencode-kagi-ken-mcp: npm is required but was not found\n' >&2
    exit 127
  fi

  mkdir -p "${install_dir}"
  npm install --no-fund --no-audit --prefix "${install_dir}" "${package_ref}"
fi

exec "${bin_path}" "$@"
